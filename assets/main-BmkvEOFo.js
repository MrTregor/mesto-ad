!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r,userId:i})=>{const c=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__like-button"),l=c.querySelector(".card__control-button_type_delete"),s=c.querySelector(".card__control-button_type_info"),u=c.querySelector(".card__image"),p=c.querySelector(".card__like-count");u.src=e.link,u.alt=e.name,c.querySelector(".card__title").textContent=e.name,p&&(p.textContent=e.likes.length);e.likes.some(e=>e._id===i)&&a.classList.add("card__like-button_is-active");return e.owner._id===i?n&&l.addEventListener("click",()=>n(c,e._id)):l.remove(),o&&a.addEventListener("click",()=>o(c,e._id,a,p)),n&&l.addEventListener("click",()=>n(c,e._id)),t&&u.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&s.addEventListener("click",()=>r(e._id)),c},t=e=>{if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");n(e)}},o=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",t)},n=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",t)};function r(e,t){return e.querySelector(`#${t.id}-error`)}function i(e,t,o){!function(e){return e.some(e=>!e.validity.valid)}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")}(t,o):function(e,t){e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled","disabled")}(t,o)}function c(e,t,o){t.dataset.errorMessage&&(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity("")),t.validity.valid?function(e,t,o){const n=r(e,t);n&&(t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass))}(e,t,o):function(e,t,o,n){const i=r(e,t);i&&(t.classList.add(n.inputErrorClass),i.textContent=o,i.classList.add(n.errorClass))}(e,t,t.validationMessage,o)}const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"e269baa8-9378-456f-bc9e-338e5ab687da","Content-Type":"application/json"}},l=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),s=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(l);var u;u={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(u.formSelector)).forEach(e=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);i(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{c(e,r,t),i(o,n,t)})})}(e,u)});const p=document.querySelector(".places__list"),d=document.querySelector(".popup_type_edit"),_=d.querySelector(".popup__form"),m=_.querySelector(".popup__input_type_name"),y=_.querySelector(".popup__input_type_description"),f=document.querySelector(".popup_type_new-card"),h=f.querySelector(".popup__form"),v=h.querySelector(".popup__input_type_card-name"),S=h.querySelector(".popup__input_type_url"),b=document.querySelector(".popup_type_image"),q=b.querySelector(".popup__image"),g=b.querySelector(".popup__caption"),k=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),P=I.querySelector(".popup__form"),$=P.querySelector(".popup__input"),A=document.querySelector(".popup_type_info"),T=A.querySelector(".popup__title"),w=A.querySelector(".popup__info"),D=A.querySelector(".popup__text"),U=A.querySelector(".popup__list");let N=null;const B=(e,t,o="Сохранение...")=>{t?(e.dataset.originalText=e.textContent,e.textContent=o):e.textContent=e.dataset.originalText||e.textContent},M=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},O=e=>{const t=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},H=({name:e,link:t})=>{q.src=t,q.alt=e,g.textContent=e,o(b)},j=(e,t)=>{(e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(l))(t).then(()=>{(e=>{e.remove()})(e)}).catch(e=>{console.log(e)})},J=(e,t,o,n)=>{((e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(l))(t,o.classList.contains("card__like-button_is-active")).then(e=>{o.classList.toggle("card__like-button_is-active"),n&&(n.textContent=e.likes.length)}).catch(e=>{console.log(e)})},V=e=>{s().then(t=>{const n=t.find(t=>t._id===e);n?(w.innerHTML="",U.innerHTML="",T.textContent="Информация о карточке",w.append(M("Описание:",n.name)),w.append(M("Дата создания:",new Date(n.createdAt).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}))),w.append(M("Владелец:",n.owner.name)),w.append(M("Количество лайков:",n.likes.length)),D.textContent="Лайкнули:",n.likes.length>0?n.likes.forEach(e=>{U.append(O(e.name))}):U.append(O("Пока никто не лайкнул")),o(A)):console.log("Карточка не найдена")}).catch(e=>{console.log(e)})};_.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;B(t,!0,"Сохранение..."),(({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(l))({name:m.value,about:y.value}).then(e=>{L.textContent=e.name,E.textContent=e.about,n(d)}).catch(e=>{console.log(e)}).finally(()=>{B(t,!1)})}),h.addEventListener("submit",t=>{t.preventDefault();const o=t.submitter;B(o,!0,"Создание..."),(({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(l))({name:v.value,link:S.value}).then(t=>{p.prepend(e(t,{onPreviewPicture:H,onLikeIcon:J,onDeleteCard:j,onInfoClick:V,userId:N})),n(f)}).catch(e=>{console.log(e)}).finally(()=>{B(o,!1)})}),P.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;var o;B(t,!0,"Сохранение..."),(o=$.value,fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:o})}).then(l)).then(e=>{x.style.backgroundImage=`url(${e.avatar})`,n(I)}).catch(e=>{console.log(e)}).finally(()=>{B(t,!1)})}),k.addEventListener("click",()=>{m.value=L.textContent,y.value=E.textContent,o(d)}),x.addEventListener("click",()=>{P.reset(),o(I)}),C.addEventListener("click",()=>{h.reset(),o(f)}),Promise.all([s(),fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(l)]).then(([t,o])=>{N=o._id,L.textContent=o.name,E.textContent=o.about,x.style.backgroundImage=`url(${o.avatar})`,t.forEach(t=>{p.append(e(t,{onPreviewPicture:H,onLikeIcon:J,onDeleteCard:j,onInfoClick:V,userId:N}))})}).catch(e=>{console.log(e)});document.querySelectorAll(".popup").forEach(e=>{var t;(t=e).querySelector(".popup__close").addEventListener("click",()=>{n(t)}),t.addEventListener("mousedown",e=>{e.target.classList.contains("popup")&&n(t)})});
//# sourceMappingURL=main-BmkvEOFo.js.map
