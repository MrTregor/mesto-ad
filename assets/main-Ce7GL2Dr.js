!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:o,onInfoClick:n,userId:a})=>{const i=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__like-button"),l=i.querySelector(".card__control-button_type_delete"),s=i.querySelector(".card__control-button_type_info"),u=i.querySelector(".card__image"),p=i.querySelector(".card__like-count");u.src=e.link,u.alt=e.name,i.querySelector(".card__title").textContent=e.name,p&&(p.textContent=e.likes.length);e.likes.some(e=>e._id===a)&&c.classList.add("card__like-button_is-active");return e.owner._id===a?o&&l.addEventListener("click",()=>o(i,e._id)):l.remove(),r&&c.addEventListener("click",()=>r(i,e._id,c,p)),t&&u.addEventListener("click",()=>t({name:e.name,link:e.link})),n&&s.addEventListener("click",()=>n(e._id)),i},t=e=>{if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");o(e)}},r=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",t)},o=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",t)};function n(e,t){return e.querySelector(`#${t.id}-error`)}function a(e,t,r){const o=n(e,t);o&&(t.classList.remove(r.inputErrorClass),o.textContent="",o.classList.remove(r.errorClass))}function i(e,t){e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled","disabled")}function c(e,t,r){!function(e){return e.some(e=>!e.validity.valid)}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")}(t,r):i(t,r)}function l(e,t,r){t.dataset.errorMessage&&(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity("")),t.validity.valid?a(e,t,r):function(e,t,r,o){const a=n(e,t);a&&(t.classList.add(o.inputErrorClass),a.textContent=r,a.classList.add(o.errorClass))}(e,t,t.validationMessage,r)}function s(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach(r=>{r.setCustomValidity(""),a(e,r,t)}),o&&i(o,t)}const u={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"e269baa8-9378-456f-bc9e-338e5ab687da","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),d=()=>fetch(`${u.baseUrl}/cards`,{headers:u.headers}).then(p),_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};var m;m=_,Array.from(document.querySelectorAll(m.formSelector)).forEach(e=>{!function(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);c(r,o,t),r.forEach(n=>{n.addEventListener("input",()=>{l(e,n,t),c(r,o,t)})})}(e,m)});const y=document.querySelector(".places__list"),f=document.querySelector(".popup_type_edit"),h=f.querySelector(".popup__form"),v=h.querySelector(".popup__input_type_name"),S=h.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),q=b.querySelector(".popup__form"),C=q.querySelector(".popup__input_type_card-name"),k=q.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_image"),g=L.querySelector(".popup__image"),E=L.querySelector(".popup__caption"),x=document.querySelector(".profile__edit-button"),$=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_edit-avatar"),w=T.querySelector(".popup__form"),D=w.querySelector(".popup__input"),U=document.querySelector(".popup_type_info"),B=U.querySelector(".popup__title"),N=U.querySelector(".popup__info"),M=U.querySelector(".popup__text"),O=U.querySelector(".popup__list");let H=null;const j=(e,t,r="Сохранение...")=>{t?(e.dataset.originalText=e.textContent,e.textContent=r):e.textContent=e.dataset.originalText||e.textContent},J=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},V=e=>{const t=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},z=({name:e,link:t})=>{g.src=t,g.alt=e,E.textContent=e,r(L)},K=(e,t)=>{(e=>fetch(`${u.baseUrl}/cards/${e}`,{method:"DELETE",headers:u.headers}).then(p))(t).then(()=>{(e=>{e.remove()})(e)}).catch(e=>{alert(`Ошибка при удалении карточки: ${e}`)})},R=(e,t,r,o)=>{((e,t)=>fetch(`${u.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:u.headers}).then(p))(t,r.classList.contains("card__like-button_is-active")).then(e=>{r.classList.toggle("card__like-button_is-active"),o&&(o.textContent=e.likes.length)}).catch(e=>{alert(`Ошибка при постановке лайка: ${e}`)})},F=e=>{d().then(t=>{const o=t.find(t=>t._id===e);o&&(N.innerHTML="",O.innerHTML="",B.textContent="Информация о карточке",N.append(J("Описание:",o.name)),N.append(J("Дата создания:",new Date(o.createdAt).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}))),N.append(J("Владелец:",o.owner.name)),N.append(J("Количество лайков:",o.likes.length)),M.textContent="Лайкнули:",o.likes.length>0?o.likes.forEach(e=>{O.append(V(e.name))}):O.append(V("Пока никто не лайкнул")),r(U))}).catch(e=>{alert(`Ошибка при загрузке информации о карточке: ${e}`)})};h.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;j(t,!0,"Сохранение..."),(({name:e,about:t})=>fetch(`${u.baseUrl}/users/me`,{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:t})}).then(p))({name:v.value,about:S.value}).then(e=>{I.textContent=e.name,P.textContent=e.about,o(f)}).catch(e=>{alert(`Ошибка при обновлении профиля: ${e}`)}).finally(()=>{j(t,!1)})}),q.addEventListener("submit",t=>{t.preventDefault();const r=t.submitter;j(r,!0,"Создание..."),(({name:e,link:t})=>fetch(`${u.baseUrl}/cards`,{method:"POST",headers:u.headers,body:JSON.stringify({name:e,link:t})}).then(p))({name:C.value,link:k.value}).then(t=>{y.prepend(e(t,{onPreviewPicture:z,onLikeIcon:R,onDeleteCard:K,onInfoClick:F,userId:H})),o(b)}).catch(e=>{alert(`Ошибка при добавлении карточки: ${e}`)}).finally(()=>{j(r,!1)})}),w.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;var r;j(t,!0,"Сохранение..."),(r=D.value,fetch(`${u.baseUrl}/users/me/avatar`,{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:r})}).then(p)).then(e=>{A.style.backgroundImage=`url(${e.avatar})`,o(T)}).catch(e=>{alert(`Ошибка при обновлении аватара: ${e}`)}).finally(()=>{j(t,!1)})}),x.addEventListener("click",()=>{v.value=I.textContent,S.value=P.textContent,s(h,_),r(f)}),A.addEventListener("click",()=>{w.reset(),s(w,_),r(T)}),$.addEventListener("click",()=>{q.reset(),s(q,_),r(b)}),Promise.all([d(),fetch(`${u.baseUrl}/users/me`,{headers:u.headers}).then(p)]).then(([t,r])=>{H=r._id,I.textContent=r.name,P.textContent=r.about,A.style.backgroundImage=`url(${r.avatar})`,t.forEach(t=>{y.append(e(t,{onPreviewPicture:z,onLikeIcon:R,onDeleteCard:K,onInfoClick:F,userId:H}))})}).catch(e=>{alert(`Ошибка при загрузке данных: ${e}`)});document.querySelectorAll(".popup").forEach(e=>{var t;(t=e).querySelector(".popup__close").addEventListener("click",()=>{o(t)}),t.addEventListener("mousedown",e=>{e.target.classList.contains("popup")&&o(t)})});
//# sourceMappingURL=main-Ce7GL2Dr.js.map
